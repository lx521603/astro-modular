---
import type { PaginationInfo } from '@/types';
import Icon from './Icon.astro';

export interface Props {
  pagination: PaginationInfo;
  baseUrl?: string;
}

const { pagination, baseUrl = '/posts' } = Astro.props;
const { currentPage, totalPages, hasNext, hasPrev } = pagination;

// 生成要显示的页码
function generatePageNumbers(current: number, total: number) {
  const pages: (number | string)[] = [];
  const delta = 2; // 当前页两侧要显示的页面数量

  // 始终显示第一页
  pages.push(1);

  // 如果需要添加省略号
  if (current - delta > 2) {
    pages.push('...');
  }

  // 添加当前页周围的页面
  for (let i = Math.max(2, current - delta); i <= Math.min(total - 1, current + delta); i++) {
    pages.push(i);
  }

  // 如果需要添加省略号
  if (current + delta < total - 1) {
    pages.push('...');
  }

  // 如果有多于一页，始终显示最后一页
  if (total > 1) {
    pages.push(total);
  }

  return pages;
}

const pageNumbers = generatePageNumbers(currentPage, totalPages);

const prevUrl = hasPrev 
    ? (currentPage === 2 ? baseUrl : `${baseUrl}/${currentPage - 1}`)
    : undefined;

  const nextUrl = hasNext 
    ? `${baseUrl}/${currentPage + 1}`
    : undefined;
---

{totalPages > 1 && (
  <nav class="flex items-center justify-between py-8" aria-label="分页">
    <!-- 上一页 -->
    <div class="flex-1 flex justify-start">
      {hasPrev ? (
        <a
          href={prevUrl || `${baseUrl}/${currentPage - 1}`}
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-primary-600 dark:text-primary-300 bg-white dark:bg-primary-900 border border-primary-300 dark:border-primary-600 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-800 hover:text-primary-800 dark:hover:text-primary-200 transition-colors"
        >
          <Icon name="arrow-left" class="w-4 h-4 mr-2" />
          上一页
        </a>
      ) : (
        <span class="inline-flex items-center px-4 py-2 text-sm font-medium text-primary-400 dark:text-primary-500 bg-primary-100 dark:bg-primary-800 border border-primary-200 dark:border-primary-700 rounded-lg cursor-not-allowed">
          <Icon name="arrow-left" class="w-4 h-4 mr-2" />
          上一页
        </span>
      )}
    </div>

    <!-- 页码 -->
    <div class="hidden md:flex items-center space-x-2">
      {pageNumbers.map(page => (
        typeof page === 'number' ? (
          <a
            href={page === 1 ? baseUrl : `${baseUrl}/${page}`}
            class={`inline-flex items-center justify-center w-10 h-10 text-sm font-medium rounded-lg transition-colors ${
              page === currentPage
                ? 'btn-primary'
                : 'text-primary-600 dark:text-primary-300 bg-white dark:bg-primary-900 border border-primary-300 dark:border-primary-600 hover:bg-primary-50 dark:hover:bg-primary-800 hover:text-primary-800 dark:hover:text-primary-200'
            }`}
            aria-current={page === currentPage ? 'page' : undefined}
          >
            {page}
          </a>
        ) : (
          <span class="inline-flex items-center justify-center w-10 h-10 text-sm text-primary-400 dark:text-primary-500">
            {page}
          </span>
        )
      ))}
    </div>

    <!-- 移动端页面指示器 -->
    <div class="md:hidden flex items-center space-x-2 text-sm text-primary-600 dark:text-primary-300">
      <span>
        第 {currentPage} 页，共 {totalPages} 页
      </span>
    </div>

    <!-- 下一页 -->
    <div class="flex-1 flex justify-end">
      {hasNext ? (
        <a
          href={nextUrl || `${baseUrl}/${currentPage + 1}`}
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-primary-600 dark:text-primary-300 bg-white dark:bg-primary-900 border border-primary-300 dark:border-primary-600 rounded-lg hover:bg-primary-50 dark:hover:bg-primary-800 hover:text-primary-800 dark:hover:text-primary-200 transition-colors"
        >
          下一页
          <Icon name="arrow-right" class="w-4 h-4 ml-2" />
        </a>
      ) : (
        <span class="inline-flex items-center px-4 py-2 text-sm font-medium text-primary-400 dark:text-primary-500 bg-primary-100 dark:bg-primary-800 border border-primary-200 dark:border-primary-700 rounded-lg cursor-not-allowed">
          下一页
          <Icon name="arrow-right" class="w-4 h-4 ml-2" />
        </span>
      )}
    </div>
  </nav>
)}

<style>
  /* 增强的分页样式 */
  nav[aria-label="分页"] {
    @apply select-none;
  }

  /* 所有交互元素的平滑过渡 */
  nav[aria-label="分页"] a,
  nav[aria-label="分页"] span {
    @apply transition-all duration-200;
  }

  /* 焦点样式 */
  nav[aria-label="分页"] a:focus-visible {
    @apply outline-none ring-2 ring-highlight-500 ring-offset-2;
  }

  /* 当前页面增强 */
  nav[aria-label="分页"] [aria-current="page"] {
    @apply shadow-lg;
  }

  /* 悬停效果 */
  nav[aria-label="分页"] a:hover {
    @apply transform scale-105;
  }
</style>